<?xml version="1.0" encoding="UTF-8"?>
<div xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xf="http://www.w3.org/2002/xforms" data-template="templates:surround" data-template-at="content" data-template-with="templates/page.html">
    <xf:model id="model1" style="display:none;">

        <xf:instance xmlns="" id="tablets">
            <tablets/>
        </xf:instance>

        <xf:instance xmlns="" id="tablet">
            <TEI xmlns="http://www.tei-c.org/ns/1.0"/>
        </xf:instance>

        <xf:instance id="template" resource="exist:/db/apps/cuneidb/template.xml"/>
        <xf:instance id="standardSigns" resource="exist:/db/apps/cuneidb/data/etc/stdSigns/stdSigns.xml"/>

        <xf:instance xmlns="" id="selectedTablet">
            <selectedTablet>
                <path/>
                <img-path/>
            </selectedTablet>
        </xf:instance>

        <xf:instance id="listFilter" xmlnd="">
            <filterExpression/>
        </xf:instance>

        <xf:instance xmlns="" id="prototypes">
            <TEI xmlns="http://www.tei-c.org/ns/1.0">
                <bibl type="transliteration">[new bibligraphic reference]</bibl>
                <person role="mentioned">
                    <persName>[new person]</persName>
                </person>
            </TEI>
        </xf:instance>

        <xf:instance xmlns="" id="certainity">
            <certainity>
                <cert>high</cert>
                <cert>medium</cert>
                <cert>low</cert>
                <cert>unknown</cert>
            </certainity>
        </xf:instance>


        <xf:instance xmlns="" id="persons" resource="exist:/db/apps/cuneidb/data/etc/persons.xml"/>
        <xf:instance xmlns="" id="taxonomies" resource="exist:/db/apps/cuneidb/data/etc/taxonomies.xml"/>
        <xf:instance xmlns="" id="places" resource="exist:/db/apps/cuneidb/data/etc/places.xml"/>


        <xf:bind id="scribes" ref="instance('persons')/tei:text/tei:body/tei:listPerson[@xml:id='scribes']/tei:person"/>
        <xf:bind id="periods" ref="instance('taxonomies')/tei:teiHeader/tei:encodingDesc/tei:classDecl/tei:taxonomy[@xml:id='periods']/tei:category"/>
        <xf:bind id="genres" ref="instance('taxonomies')/tei:teiHeader/tei:encodingDesc/tei:classDecl/tei:taxonomy[@xml:id='genres']/tei:category"/>
        <xf:bind id="ductusFDecl" ref="instance('taxonomies')/tei:teiHeader/tei:encodingDesc/tei:fsdDecl/tei:fsDecl[1]/tei:fDecl[1]/tei:vRange/tei:vAlt/tei:symbol"/>
        <xf:bind id="placesOfIssue" ref="instance('places')/tei:text/tei:body/tei:listPlace/tei:place"/>
        <xf:bind constraint="matches(.,'(^\d{1,2}/\d{1,2}/\-?\d{1,4}$)?')" id="dateOfIssue" ref="instance('tablet')/tei:teiHeader/tei:profileDesc/tei:creation/tei:origDate/tei:date[not(@type)]"/>


        <xf:submission id="ls" method="execute" omit-xml-declaration="true" ref="instance('tablets')" replace="instance" resource="exist:/db/apps/cuneidb/api/lsTablets.xql">
            <xf:message ev:event="xforms-submit-error" level="ephemeral">tablets listing has failed</xf:message>
            <!--<xf:message ev:event="xforms-submit-done" level="ephemeral">tablets listed successfully</xf:message>-->
        </xf:submission>

        <xf:submission id="loadTablet" method="get" ref="instance('tablet')" replace="instance">
            <xf:resource value="concat('exist:',instance('selectedTablet')/path)"/>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">loading tablet has failed</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">tablet loaded successfully</xf:message>
        </xf:submission>

        <xf:submission id="saveTablet" method="put" ref="instance('tablet')" replace="instance">
            <xf:resource value="concat('exist:',instance('selectedTablet')/path)"/>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">saving tablet has failed</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">tablet saved successfully</xf:message>
        </xf:submission>

        <xf:submission id="removeTablet" method="delete" ref="instance('tablet')" replace="instance">
            <xf:resource value="concat('exist:',instance('selectedTablet')/path)"/>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">tablet could not be removed</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">tablet removed successfully</xf:message>
        </xf:submission>

        <xf:submission id="removeImg" method="delete" ref="instance('tablet')" replace="instance">
            <xf:resource value="concat('exist:',instance('selectedTablet')/img-path)"/>
            <xf:message ev:event="xforms-submit-error" level="ephemeral">tablet could not be removed</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">tablet removed successfully</xf:message>
        </xf:submission>




        <xf:instance xmlns="" id="signs">
            <return>
                <tablet>tablet-id</tablet>
            </return>
        </xf:instance>

        <xf:submission id="extractSigns" method="execute" ref="instance('tablet')" replace="instance" resource="exist:/db/apps/cuneidb/api/extractGlyphs.xql">
            <xf:message ev:event="xforms-submit-error" level="ephemeral">glyph information could not be extracted</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">ok</xf:message>
        </xf:submission>





        <xf:instance xmlns="" id="newTabletPrototype">
            <newTablet status="toBeSent">
                <img filename="" mediatype="" size=""/>
                <data/>
                <message/>
            </newTablet>
        </xf:instance>

        <xf:instance xmlns="" id="newTablet">
            <newTablet status="toBeSent">
                <img filename="" mediatype="" size=""/>
                <data/>
                <message/>
            </newTablet>
        </xf:instance>





        <!-- title must have been changed -->
        <xf:bind constraint=". != instance('template')/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title" ref="instance('newTablet')/data/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title"/>

        <xf:bind calculate="concat('tablet_',replace(translate(../tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title,'üäöß','uaos'),'[^A-Za-z0-9_-]',''))" constraint="not(. = instance('tablets')/tablet/id)" ref="instance('newTablet')/data/tei:TEI/@xml:id" type="xsi:ID"/>

        <xf:bind id="img-data" ref="instance('newTablet')/img" type="xs:anyURI"/>

        <xf:submission id="storeNewTablet" method="execute" ref="instance('newTablet')" replace="instance" resource="exist:/db/apps/cuneidb/api/newTablet.xql">
            <xf:message ev:event="xforms-submit-error" level="ephemeral">tablet could not be created</xf:message>
            <xf:message ev:event="xforms-submit-done" level="ephemeral">tablet created successfully</xf:message>
        </xf:submission>


        <xf:action ev:event="xforms-ready">
            <!-- fetch tablets list on load -->
            <xf:send submission="ls"/>
            <xf:message level="ephemeral">form loaded</xf:message>
        </xf:action>
    </xf:model>

    <div class="page-header">
        <h1>Tablets</h1>
    </div>

    <div class="row-fluid">
        <div class="span5">

            <xf:input incremental="true" ref="instance('listFilter')">
                <xf:label>Filter list</xf:label>
            </xf:input>

            <table class="table">
                <thead>
                    <tr>
                        <!--<th>ID</th>-->
                        <th>Text Reference</th>
                        <!--<th>Path</th>
                        <th>Image</th>-->
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="lsTablets" xf:repeat-nodeset="instance('tablets')/tablet[contains(title,instance('listFilter'))]">
                    <tr>
                        <!--<td>
                            <xf:output ref="id"/>
                        </td>-->
                        <td>
                            <xf:output ref="title"/>
                        </td>
                        <!--<td>
                            <xf:output ref="path"/>
                        </td>
                        <td>
                            <xf:output ref="img-path"/>
                        </td>-->
                        <td>
                            <xf:group appearance="minimal">
                                <xf:trigger>
                                    <xf:label>edit</xf:label>
                                    <xf:setvalue ref="instance('selectedTablet')/path" value="context()/path"/>
                                    <xf:setvalue ref="instance('selectedTablet')/img-path" value="context()/img-path"/>
                                    <xf:send submission="loadTablet"/>
                                </xf:trigger>
                                <xf:trigger>
                                    <xf:label>remove</xf:label>
                                    <xf:setvalue ref="instance('selectedTablet')/path" value="context()/path"/>
                                    <xf:setvalue ref="instance('selectedTablet')/img-path" value="context()/img-path"/>
                                    <xf:send submission="removeTablet"/>
                                    <xf:send submission="removeImg"/>
                                    <xf:send submission="ls"/>
                                </xf:trigger>
                            </xf:group>
                        </td>
                    </tr>
                </tbody>
            </table>
            <xf:switch>
                <xf:case id="newTabletMenuDefault">
                    <xf:trigger>
                        <xf:label>New Tablet</xf:label>
                        <xf:insert context="instance('newTablet')/data" origin="instance('template')"/>
                        <xf:toggle case="newTabletMenu"/>
                        <xf:action>
                            <script type="text/javascript">
                                $("#overlay").attr("class","visible")
                            </script>
                        </xf:action>
                    </xf:trigger>
                </xf:case>

                <xf:case id="newTabletMenuResult">
                    <h3>Result</h3>
                    <xf:output ref="instance('newTablet')/message"/>
                    <xf:trigger ev:event="DOMActivate">
                        <xf:label>Close</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <script type="text/javascript">
                                $("#overlay").attr("class","invisible");
                            </script>
                        </xf:action>
                        <!-- reset instance 'newTablet' -->
                        <xf:setvalue ref="instance('newTablet')/@status" value="instance('newTabletPrototype')/@status"/>
                        <xf:delete ref="instance('newTablet')/*"/>
                        <xf:insert context="instance('newTablet')" origin="instance('newTabletPrototype')/*"/>
                        <xf:toggle case="newTabletMenuDefault"/>
                    </xf:trigger>
                </xf:case>

                <xf:case id="newTabletMenu">
                    <h3>New Tablet</h3>
                    <xf:group appearance="bf:verticalTable">
                        <xf:input incremental="true" ref="instance('newTablet')[@status='toBeSent']/data/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title">
                            <xf:label>Text Reference</xf:label>
                            <xf:alert>Text Reference has to be set</xf:alert>
                            <xf:setvalue ev:event="xforms-value-changed" ref="instance('newTablet')/data/tei:TEI/tei:teiHeader/tei:fileDesc/tei:sourceDesc/tei:msDesc/tei:msIdentifier/tei:idno" value="instance('newTablet')/data/tei:TEI/tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title"/>
                        </xf:input>

                        <xf:output incremental="true" ref="instance('newTablet')[@status='toBeSent']/data/tei:TEI/@xml:id">
                            <xf:label>ID</xf:label>
                            <xf:alert>Tablet exists already</xf:alert>
                        </xf:output>

                        <xf:upload ref="instance('newTablet')/img">
                            <xf:label>Upload Image File</xf:label>
                            <xf:filename ref="@filename"/>
                            <xf:mediatype ref="@mediatype"/>
                            <xf:size ref="@size"/>
                        </xf:upload>

                        <xf:group>
                            <xf:trigger>
                                <xf:label>Create</xf:label>
                                <xf:send submission="storeNewTablet"/>
                                <xf:send submission="ls"/>
                                <xf:toggle case="newTabletMenuResult"/>
                            </xf:trigger>
                            <xf:trigger>
                                <xf:label>abort</xf:label>
                                <xf:delete ref="instance('newTablet')/data/tei:TEI"/>
                                <xf:delete ref="instance('newTablet')/message/node()"/>
                                <xf:delete ref="instance('newTablet')/img/node()"/>
                                <xf:action ev:event="DOMActivate">
                                    <script type="text/javascript">
                                        $("#overlay").attr("class","invisible")
                                    </script>
                                </xf:action>
                                <xf:toggle case="newTabletMenuDefault"/>
                            </xf:trigger>
                        </xf:group>
                    </xf:group>
                </xf:case>
            </xf:switch>
        </div>

        <div class="span7">
            <xf:group ref="instance('tablet')/tei:teiHeader">
                <h3>
                    <i>
                        <xf:output ref="tei:fileDesc/tei:titleStmt/tei:title"/>
                    </i>
                </h3>
                <div class="tabbable" id="edit-tabs">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a data-toggle="tab" href="#tab1">Archive Information</a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#tab-creation">Creation</a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#tab3">Script</a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#tab4">Content</a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#tab-transliterations">Transliterations</a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#tab-signs">Signs</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab1">
                            <h4>Archive Information</h4>
                            <xf:group appearance="bf:verticalTable" ref="tei:fileDesc/tei:sourceDesc/tei:msDesc">
                                <xf:input ref="tei:msIdentifier/tei:region">
                                    <xf:label>Region</xf:label>
                                </xf:input>
                                <xf:input ref="tei:msIdentifier/tei:collection[@type='archive']">
                                    <xf:label>Collection</xf:label>
                                </xf:input>
                                <xf:input ref="tei:msIdentifier/tei:collection[@type='dossier']">
                                    <xf:label>Dossier</xf:label>
                                </xf:input>
                                <xf:input ref="tei:msIdentifier/tei:idno">
                                    <xf:label>Text Reference</xf:label>
                                </xf:input>
                            </xf:group>
                            <xf:group ref="tei:fileDesc/tei:sourceDesc/tei:msDesc">
                                <xf:label>References</xf:label>
                                <xf:input ref="tei:msIdentifier/tei:altIdentifier[@type='CDLI']/tei:idno">
                                    <xf:label>CDLI no.</xf:label>
                                </xf:input>
                                <xf:input ref="tei:msIdentifier/tei:altIdentifier[@type='NABUCCO']/tei:idno">
                                    <xf:label>NABUCCO no.</xf:label>
                                </xf:input>
                            </xf:group>
                        </div>
                        <div class="tab-pane" id="tab-creation">
                            <h4>Creation</h4>
                            <xf:group>
                                <xf:group>
                                    <xf:label>Scribe</xf:label>
                                    <xf:select1 appearance="minimal" id="select1" incremental="true" ref="tei:fileDesc/tei:sourceDesc/tei:msDesc/tei:physDesc/tei:handDesc/tei:handNote/tei:persName[@role='scribe']">
                                        <xf:label>Name</xf:label>
                                        <xf:itemset bind="scribes">
                                            <xf:label ref="tei:persName"/>
                                            <xf:value ref="tei:persName"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </xf:group>


                                <xf:group>
                                    <xf:label>Period</xf:label>
                                    <xf:select1 ref="tei:profileDesc/tei:creation/tei:origDate/tei:date/@period">
                                        <xf:label>Period</xf:label>
                                        <xf:itemset bind="periods">
                                            <xf:label ref="tei:catDesc"/>
                                            <xf:value ref="@xml:id"/>
                                        </xf:itemset>
                                    </xf:select1>


                                    <!--<xf:select1 ref="tei:profileDesc/tei:creation/tei:origDate/tei:date[@type='period']/@cert">
                                        <xf:label>Certainity</xf:label>
                                        <xf:itemset nodeset="instance('certainity')/cert">
                                            <xf:label ref="."/>
                                            <xf:value ref="."/>
                                        </xf:itemset>
                                    </xf:select1>-->
                                </xf:group>

                                <xf:group>
                                    <xf:label>Date of Issue</xf:label>
                                    <xf:input ref="tei:profileDesc/tei:creation/tei:origDate/tei:date[not(@type)]">
                                        <xf:label>Date</xf:label>
                                        <xf:hint>dd/mm/-yyy</xf:hint>
                                    </xf:input>
                                    <!--<xf:input ref="tei:profileDesc/tei:creation/tei:origDate/tei:date[not(@type)]/@notAfter">
                                        <xf:label>ante quem</xf:label>
                                    </xf:input>
                                    <xf:input ref="tei:profileDesc/tei:creation/tei:origDate/tei:date[not(@type)]/@notBefore">
                                        <xf:label>post quem</xf:label>
                                    </xf:input>
                                    <xf:select1 ref="tei:profileDesc/tei:creation/tei:origDate/tei:date[not(@type)]/@cert">
                                        <xf:label>Certainity</xf:label>
                                        <xf:item>
                                            <xf:label>high</xf:label>
                                            <xf:value>high</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>medium</xf:label>
                                            <xf:value>medium</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>low</xf:label>
                                            <xf:value>low</xf:value>
                                        </xf:item>
                                        <xf:item>
                                            <xf:label>unknown</xf:label>
                                            <xf:value>unknown</xf:value>
                                        </xf:item>
                                    </xf:select1>-->
                                </xf:group>

                                <xf:group>
                                    <xf:label>Place of issue</xf:label>
                                    <xf:select1 ref="tei:profileDesc/tei:creation/tei:origPlace/tei:placeName">
                                        <xf:label>Place</xf:label>
                                        <xf:itemset bind="placesOfIssue">
                                            <xf:label ref="tei:placeName"/>
                                            <xf:value ref="tei:placeName"/>
                                        </xf:itemset>
                                    </xf:select1>
                                    <xf:select1 ref="tei:profileDesc/tei:creation/tei:origPlace/@cert">
                                        <xf:label>Certainity</xf:label>
                                        <xf:itemset nodeset="instance('certainity')/cert">
                                            <xf:label ref="."/>
                                            <xf:value ref="."/>
                                        </xf:itemset>
                                    </xf:select1>
                                </xf:group>


                            </xf:group>
                        </div>
                        <div class="tab-pane" id="tab3">
                            <h4>Script</h4>
                            <xf:select1 ref="tei:fileDesc[1]/tei:sourceDesc[1]/tei:msDesc[1]/tei:physDesc[1]/tei:handDesc[1]/tei:handNote[1]/tei:fs[1]/tei:f[@name='ductus']/tei:symbol[1]/@value">
                                <xf:label>Script Ductus</xf:label>
                                <xf:itemset bind="ductusFDecl">
                                    <xf:label ref="@value"/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                        <div class="tab-pane" id="tab4">
                            <h4>Content</h4>
                            <xf:group appearance="bf:verticalTable">
                                <xf:select1 ref="tei:profileDesc/tei:textClass/tei:keywords/tei:term">
                                    <xf:label>Text type</xf:label>
                                    <xf:itemset bind="genres">
                                        <xf:label ref="tei:catDesc"/>
                                        <xf:value ref="tei:catDesc"/>
                                    </xf:itemset>
                                </xf:select1>
                                <xf:group appearance="bf:horizontalTable">
                                    <xf:textarea ref="tei:profileDesc/tei:abstract/tei:ab">
                                        <xf:label>Paraphrase</xf:label>
                                    </xf:textarea>
                                    <xf:select1 ref="tei:profileDesc/tei:abstract/@xml:lang">
                                        <xf:label>Paraphrase Language</xf:label>
                                        <xf:item>
                                            <xf:value>en</xf:value>
                                            <xf:label>English</xf:label>
                                        </xf:item>
                                        <xf:item>
                                            <xf:value>de</xf:value>
                                            <xf:label>German</xf:label>
                                        </xf:item>
                                    </xf:select1>
                                </xf:group>
                            </xf:group>


                            <h4 id="list-persons-mentioned-head">Distinctive Protagonists</h4>

                            <xf:repeat id="list-persons-mentioned" nodeset="tei:profileDesc/tei:particDesc/tei:person[@role='mentioned']">
                                <xf:output ref="tei:persName"/>
                            </xf:repeat>
                            <xf:input ref="tei:persName">
                                <xf:label>Name: </xf:label>
                            </xf:input>

                            <div id="edit-current-person-mentioned">
                                <xf:trigger>
                                    <xf:label>Delete</xf:label>
                                    <xf:delete nodeset="tei:profileDesc/tei:particDesc/tei:person[@role='mentioned'][index('list-persons-mentioned')]"/>
                                </xf:trigger>

                                <xf:trigger>
                                    <xf:label>New</xf:label>
                                    <xf:insert context="tei:profileDesc/tei:particDesc" origin="instance('prototypes')/tei:person[@role='mentioned']"> </xf:insert>
                                </xf:trigger>

                                <br/>

                                <xf:input id="edit-current-person-mentioned" incremental="true" ref="tei:profileDesc/tei:particDesc/tei:person[@role='mentioned'][index('list-persons-mentioned')]/tei:persName">
                                    <xf:label>Edit selected person:</xf:label>
                                </xf:input>
                            </div>

                        </div>
                        <div class="tab-pane" id="tab-transliterations">
                            <h4>Transliterations</h4>

                            <xf:repeat id="list-translit" nodeset="tei:fileDesc[1]/tei:sourceDesc[1]/tei:msDesc[1]/tei:additional[1]/tei:surrogates[1]/tei:listBibl[@type='transliterations']/tei:bibl">
                                <i>
                                    <xf:output incremental="true" ref="."/>
                                </i>
                            </xf:repeat>

                            <div>
                                <xf:trigger>
                                    <xf:label>Delete</xf:label>
                                    <xf:delete nodeset="tei:fileDesc[1]/tei:sourceDesc[1]/tei:msDesc[1]/tei:additional[1]/tei:surrogates[1]/tei:listBibl[@type='transliterations']/tei:bibl[index('list-translit')]"/>
                                </xf:trigger>

                                <xf:trigger>
                                    <xf:label>New</xf:label>
                                    <xf:insert context="tei:fileDesc[1]/tei:sourceDesc[1]/tei:msDesc[1]/tei:additional[1]/tei:surrogates[1]/tei:listBibl[@type='transliterations']" origin="instance('prototypes')/tei:bibl[@type='transliteration']"> </xf:insert>
                                </xf:trigger>

                                <br/>

                                <xf:input id="edit-current-translit" incremental="true" ref="tei:fileDesc[1]/tei:sourceDesc[1]/tei:msDesc[1]/tei:additional[1]/tei:surrogates[1]/tei:listBibl[@type='transliterations']/tei:bibl[index('list-translit')]">
                                    <xf:label>Edit selected entry:</xf:label>
                                </xf:input>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-signs">
                            <h3>Signs</h3>
                            <xf:group>
                                <xf:trigger relevant="not(exists(instance('tablet')//tei:seg[@type='context']))">
                                    <xf:setvalue ref="instance('signs')/tablet" value="instance('tablet')/@xml:id"/>
                                    <xf:send submission="loadTablet"/>
                                    <xf:send submission="extractSigns"/>
                                    <xf:label>extract signs</xf:label>
                                </xf:trigger>
                            </xf:group>
                            <xf:group relevant="exists(instance('tablet')//tei:seg[@type='context'])">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Sign Name</th>
                                            <th>Reading</th>
                                            <th>Context</th>
                                            <th>Line</th>
                                            <th>Sequence</th>
                                            <th>Note</th>
                                        </tr>
                                    </thead>
                                    <tbody xf:repeat-nodeset="instance('tablet')//tei:seg[@type='context']">
                                        <tr>
                                            <td>
                                                <xf:select1 ref="tei:g/@type">
                                                    <xf:itemset ref="instance('standardSigns')//tei:char">
                                                        <xf:label ref="tei:charName"/>
                                                        <xf:value ref="tei:charName"/>
                                                    </xf:itemset>
                                                </xf:select1>
                                            </td>
                                            <td>
                                                <xf:input ref="tei:g"/>
                                            </td>
                                            <td>
                                                <xf:output ref="xs:string(.)"/>
                                            </td>
                                            <td>
                                                <xf:input ref="parent::tei:line/@n"/>
                                            </td>
                                            <td>
                                                <xf:input ref="instance('tablet')//tei:glyph[@xml:id = substring-after(current()/tei:g/@ref,'#')]/tei:charProp[tei:localName='sequence']/tei:value"/>
                                            </td>
                                            <td>
                                                <xf:input ref="tei:note"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </xf:group>

                            <!--<xf:group ref="tei:sourceDoc">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Sign Name</th>
                                            <th>Sign Number</th>
                                            <th>Reading</th>
                                            <th>Context</th>
                                            <th>Sequence</th>
                                        </tr>
                                    </thead>
                                    <tbody xf:repeat-nodeset="instance('tablet')/tei:sourceDoc/tei:l/tei:g">
                                        <tr>
                                            <td><xf:output ref="@type"/></td>
                                            <td><xf:output ref="@n"/></td>
                                            <td><xf:output ref="."/></td>
                                            <td><xf:output ref="../tei:seg[@type='context']"/></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </xf:group>-->
                        </div>
                    </div>
                </div>

                <xf:group appearance="minimal" id="tabletEditButtons">
                    <xf:trigger>
                        <xf:label>store</xf:label>
                        <xf:send submission="saveTablet"/>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label>revert</xf:label>
                        <xf:reset/>
                        <xf:send submission="ls"/>
                    </xf:trigger>
                </xf:group>
            </xf:group>
        </div>
    </div>
</div>